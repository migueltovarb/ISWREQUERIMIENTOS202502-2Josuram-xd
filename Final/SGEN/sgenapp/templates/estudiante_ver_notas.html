<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mis Notas • SGEN</title>
<style>
  :root{
    --brand-blue: #1565C0;
    --brand-red: #D32F2F;
    --success: #2E7D32;
    --bg:#FFFFFF;
    --text:#111111;
    --muted:#6B7280;
    --border:#DADCE0;
    --shadow:0 8px 24px rgba(16,24,40,.08);
    --font-sans:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, sans-serif;
    --space-4:1rem;
    --space-6:1.5rem;
    --space-8:2rem;
    --radius-xl:1.25rem;
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0}
  body{font-family:var(--font-sans); font-size:15px; color:var(--text); background:linear-gradient(180deg,#fafafb, #f4f6fa 60%, #eef2f7)}
  .container{max-width:1000px; margin:0 auto; padding:var(--space-8)}
  .header h1{margin:0}
  .btn{appearance:none; border:1px solid var(--border); background:#e5e7eb; color:var(--text); padding:.625rem 1rem; border-radius:999px; font-weight:600; cursor:pointer; transition:.15s; text-decoration:none; display:inline-block}
  .btn:hover{background:#dadce0}
  .card{background:var(--bg); border:1px solid var(--border); border-radius:var(--radius-xl); box-shadow:var(--shadow); padding:var(--space-6); margin-bottom:var(--space-6)}
  .card h2{margin:0 0 var(--space-4)}
  .materia-card{background:#f7f7f9; border-left:4px solid var(--brand-blue); padding:var(--space-6); margin-bottom:var(--space-6); border-radius:.5rem}
  .materia-card h3{margin:0 0 var(--space-4); color:var(--brand-blue)}
  .table{width:100%; border-collapse:separate; border-spacing:0; border:1px solid var(--border); border-radius:.5rem; overflow:hidden; margin-bottom:var(--space-6)}
  .table th, .table td{padding:.75rem; border-bottom:1px solid var(--border); text-align:left}
  .table thead th{background:#F7F7F9; font-weight:700}
  .promedio-box{background:var(--success); color:#fff; padding:var(--space-4); border-radius:.5rem; text-align:center; font-weight:700; font-size:18px; margin-bottom:var(--space-6)}
  .status-pending{color:#ED6C02}
  .status-done{color:var(--success)}
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Mis Calificaciones</h1>
    </div>

    {% if todas_notas %}
      <!-- Mostrar todas las materias -->
      {% for materia in materias %}
        <div class="materia-card">
          <h3>{{ materia.materia.nombre }} ({{ materia.materia.codigo }})</h3>
          
          {% if materia.calificaciones %}
            <table class="table">
              <thead>
                <tr>
                  <th>Tipo de Evaluación</th>
                  <th>Porcentaje</th>
                  <th>Nota</th>
                  <th>Observación</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>
                {% for cal in materia.calificaciones %}
                <tr>
                  <td>{{ cal.tipo_evaluacion.nombre }}</td>
                  <td>{{ cal.tipo_evaluacion.porcentaje }}%</td>
                  <td>
                    {% if cal.nota %}
                      <strong>{{ cal.nota|floatformat:1 }}</strong>
                    {% else %}
                      <span class="status-pending">Pendiente</span>
                    {% endif %}
                  </td>
                  <td>{{ cal.observacion|default:"—" }}</td>
                  <td>
                    {% if cal.nota %}
                      <span class="status-done">✓ Registrada</span>
                    {% else %}
                      <span class="status-pending">Pendiente</span>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>

            <div class="promedio-box">
              Promedio: {{ materia.promedio|floatformat:2 }}
            </div>
          {% else %}
            <p>No hay calificaciones registradas para esta materia</p>
          {% endif %}
        </div>
      {% endfor %}

      <div class="card">
        <a href="{% url 'estudiante_seleccionar_materia' %}" class="btn">← Seleccionar otra materia</a>
        <a href="{% url 'estudiante_dashboard' %}" class="btn" style="margin-left:.5rem">Volver al Panel</a>
      </div>
    {% else %}
      <!-- Mostrar una materia específica -->
      <div class="card">
        <h2>{{ materia_grupo.materia.nombre }}</h2>
        <p><strong>Código:</strong> {{ materia_grupo.materia.codigo }}</p>
        <p><strong>Grupo:</strong> {{ materia_grupo.grupo.nombre }} - {{ materia_grupo.grupo.periodo.nombre }}</p>
      </div>

      {% if calificaciones %}
        <table class="table">
          <thead>
            <tr>
              <th>Tipo de Evaluación</th>
              <th>Porcentaje</th>
              <th>Nota</th>
              <th>Observación</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            {% for cal in calificaciones %}
            <tr>
              <td>{{ cal.tipo_evaluacion.nombre }}</td>
              <td>{{ cal.tipo_evaluacion.porcentaje }}%</td>
              <td>
                {% if cal.nota %}
                  <strong>{{ cal.nota|floatformat:1 }}</strong>
                {% else %}
                  <span class="status-pending">Pendiente</span>
                {% endif %}
              </td>
              <td>{{ cal.observacion|default:"—" }}</td>
              <td>
                {% if cal.nota %}
                  <span class="status-done">✓ Registrada</span>
                {% else %}
                  <span class="status-pending">Pendiente</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <div class="promedio-box">
          Promedio Final: {{ promedio|floatformat:2 }}
        </div>
      {% else %}
        <div class="card">
          <p>No hay calificaciones registradas para esta materia</p>
        </div>
      {% endif %}

      <div class="card">
        <a href="{% url 'estudiante_seleccionar_materia' %}" class="btn">← Seleccionar otra materia</a>
        <a href="{% url 'estudiante_dashboard' %}" class="btn" style="margin-left:.5rem">Volver al Panel</a>
      </div>
    {% endif %}
  </div>
</body>
</html>
